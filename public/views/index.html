<!DOCTYPE html>


<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <link rel="stylesheet" href="styles.css" />
  <script language="javascript" type="module" src="timer.mjs"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"
    integrity="sha384-/KNQL8Nu5gCHLqwqfQjA689Hhoqgi2S84SNUxC3roTe4EhJ9AfLkp8QiQcU8AMzI"
    crossorigin="anonymous"></script>
</head>

<body>

  <div class="header-container">
    <ul class="nav-list">
      <li><a href="/">Home</a></li>
      <li><a href="/PlayLocally">Play Locally</a></li>
      <li><a href="/BoardEditor">Board Editor</a></li>
    </ul>
  </div>


  <div id="game-option-container">
    <button class="btn" id="one-zero">
      <p>Bullet<br />1|0</p>
    </button>

    <button class="btn" id="three-zero">
      <p>Blitz<br />3|0</p>
    </button>

    <button class="btn" id="three-two">
      <p>Blitz<br />3|2</p>
    </button>

    <button class="btn" id="five-zero">
      <p>Blitz<br />5|0</p>
    </button>

    <button class="btn" id="five-three">
      <p>Blitz<br />5|3</p>
    </button>

    <button class="btn" id="ten-zero">
      <p>Rapid<br />10|0</p>
    </button>

    <button class="btn" id="thirty-zero">
      <p>Classical<br />30|0</p>
    </button>

    <button class="btn" id="custom">
      <p>Custom</p>
    </button>

  </div>

  <div id="matchmaking-table"></div>

  <div class="dropdown">
    <button onclick="myFunction()" class="dropbtn">Dropdown</button>
    <div id="my-dropdown" class="dropdown-content">
      <a href="#">hwllo</a>
      <a href="#">hello</a>
      <a href="#">hillo</a>
    </div>
  </div>

  <script type="text/javascript">
    let popupOpen = true;

function closePopup() {
        var el = document.getElementById('popup');
        var BG = document.getElementById('bgcover');
        el.style.display = 'none';
        BG.style.display = 'none';
    }

    function yo(){
        alert('yo');
    }

    function addElement() {
        // create a new div element
        // and give it popup content
        var newDiv = document.createElement("div");
        var texts = '';
        newDiv.innerHTML += `
            <div id="popup" style=" 
                position: absolute;
                top: 25%;
                width: 300px;
                height: 300px;
                margin: auto;
                z-index: 99999;
                display: block;
                left:35%;
                background-color: #fff;
                border: 1px solid #ddd;
                border-radius: 5px;  
                box-shadow: 0 1px 6px 4px #000;  
                overflow: hidden;   
                padding: 10px;">
                
                <div class="popup-body" id="popup-content" style="height: 160px;">${texts}</div>
                <button style="position: absolute; width: 125px; height: 100px; top:10px; right: 10px; padding: 10px; z-index: 9999;" class="btn btn-dark" id="rematch-btn">Time</button>
                <button style="position: absolute; padding: 10px; z-index: 9999; width: 125px; height: 100px; top: 10px; left: 10px" class="btn btn-dark" id="home-screen-btn" onclick="location.href='/';">Increment</button>
            </div>
        `;

        // Add The Background cover
        let BG = document.createElement("div");
        BG.style.width = '100%';
        BG.style.height = '100%';
        BG.style.background = 'black';
        BG.style.position = 'fixed';
        BG.style.top = '0';
        BG.style.left = '0';
        BG.style.opacity = '0.9';
        BG.style.display = 'none';
        BG.setAttribute("id", "bgcover");

        // add the newly created elements and its content into the DOM
        document.body.appendChild(BG);
        document.body.insertBefore(newDiv, BG);
    }

    function openPopup() {
      var el = document.getElementById('popup');
      var BG = document.getElementById('bgcover');
      el.style.display = 'block';
      BG.style.display = 'block';
    }


    var socket = io.connect('http://localhost:3000');
    // var socket = io.connect('https://bannman71-p5chess-674rjrqr9vxh4grq-3000.preview.app.github.dev');
    let tableData = document.getElementById('matchmaking-table');

    socket.on("updateMatchmakingTable", (data) => {
      tableData.innerHTML = data;
    });

    socket.on('redirect', (data) => { //called in timeControlChosen
      var url = data.page + '?time=' + data.client.time + '&increment=' + data.client.increment + '&roomCode=' + data.roomCode + '&isWhite=' + data.isWhite;
      window.location.href = url; //sends them to the page created above
    });


    function chooseTimeControl(cTime, cIncrement) {
      let data = { "time": cTime, "increment": cIncrement, id: socket.id };

      socket.emit('timeControlChosen', data);
    }

    $('#one-zero').click(() => {
      chooseTimeControl(1, 0);
    });

    $('#three-zero').click(() => {
      chooseTimeControl(3, 0);
    });

    $('#three-two').click(() => {
      chooseTimeControl(3, 2);
    });

    $('#five-zero').click(() => {
      chooseTimeControl(5, 0);
    });
    $('#five-three').click(() => {
      chooseTimeControl(5, 3);
    });

    $('#ten-zero').click(() => {
      chooseTimeControl(10, 0);
    });

    $('#thirty-zero').click(() => {
      chooseTimeControl(30, 0);
    });

    $('#custom').click(() => {
      openPopup();
      popupOpen = true;
      console.log(popupOpen);
      //have some sorta menu which chooses these numbers
      // chooseTimeControl();
    });

    $(window).click(function() {
      //Hide the menus if visible
      closePopup();
    });

    $('#custom').click((e) => {
      e.stopPropagation();
    });

    $(document).click(function(event) {
      var text = event.target.id;
      console.log(text);
    
      if (text == 'popup' || text =='popup-content') event.stopImmediatePropagation();

    });

    addElement();
    openPopup();

   
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>
</body>


</html>